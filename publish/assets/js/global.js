(()=>{function e(a){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(a)}jQuery((function(a){window.suda=window.suda||{},suda.data=function(e,a,t){return null===a&&(a=e),e in suda.meta||null==a?(t&&null!=a&&(suda.meta[e]=a),suda.meta[e]):a},suda.addMeta=function(e,a){suda.meta[e]=a},suda.link=function(e){if(e.indexOf("//")>=0)return e;var a=suda.data("UrlFormat","/{Path}");return"/"==e.substr(0,1)&&(e=e.substr(1)),a.indexOf("?")>=0&&(e=e.replace("?","&")),a.replace("{Path}",e)},suda.disable=function(e,t){var i=a(e).attr("href");i&&a.data(e,"hrefBak",i),a(e).addClass(t||"InProgress").removeAttr("href").attr("disabled",!0)},suda.enable=function(e){a(e).attr("disabled",!1).removeClass("InProgress");var t=a.data(e,"hrefBak");t&&(a(e).attr("href",t),a.removeData(e,"hrefBak"))},suda.infobox=function(e){var t="";Array.isArray(e)?a.each(e,(function(e,a){t+=e+":"+a+"<br>"})):t=e,window.confirm(t)},suda.alert=function(e,t){var i="";Array.isArray(e)?a.each(e,(function(e,a){i+=e+":"+a+"<br>"})):i=e,null==t&&(t="dark");var n='<div class="suda-toast toast position-absolute top-0 start-50" data-bs-autohide="true" data-bs-delay="2500" style="z-index:9999;transform:translate(-50%,20%)" >';n+='<div class="toast-header text-'+t+'" style="background:#efefef;">',n+='<i class="ion-alert-circle"></i>&nbsp;',n+='<span class="me-auto">提示</span>',n+='<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>',n+="</div>",n+='<div class="toast-body">'+i+"</div>",n+="</div>",a("body").find(".suda-toast").remove(),a("body").append(n),a("body").find(".suda-toast").toast("show")},suda.modal=function(t,i,n,o,r){a.ajax({type:"GET",url:"/sudarun/error/ajax",cache:!1,success:function(d){if(d){a("body").append(a(d));var l="";if(Array.isArray(t)?a.each(t,(function(e,a){l+=e+":"+a+"<br>"})):l="object"==e(t)?t.error:t,null!=i&&a(".errormodal").addClass("errormodal-"+i),a(".errormodal").find(".modal-body").append(l),null!=r&&a(".errormodal").find(".modal-footer").prepend(r),a(".errormodal").modal("show"),a(".errormodal").on("hidden.bs.modal",(function(e){a(".errormodal").remove()})),n&&n>0)var s=0,u=setInterval((function(){(s+=1)===n&&clearInterval(u),a(".errormodal").modal("hide")}),3e3);null!=o&&""!=o&&(window.location.href=o)}}})},a.fn.zpupload=function(e){var i={action:"",maxSize:52428800,label:"拖拽 或 点击上传",leave:"有图片正在上传，确定退出么",maxQueue:1,maxFiles:!1,multiple:!1,maxConcurrent:1,postData:{},delete:!0,onComplete:t.onFileComplete,onStart:t.onStart,onFileStart:t.onFileStart,onFileProgress:t.onFileProgress,onFileError:t.onFileError,onQueued:t.onQueued,postKey:"file"},n=a.extend({},i,e),o=a(this);t.options=n,o.upload({action:n.action,maxSize:n.maxSize,beforeSend:t.onBeforeSend,label:n.label,leave:n.leave,maxQueue:n.maxQueue,maxFiles:n.maxFiles,multiple:n.multiple,maxConcurrent:n.maxConcurrent,postData:n.postData,postKey:n.postKey}).on("start.upload",n.onStart).on("filestart.upload",n.onFileStart).on("fileprogress.upload",n.onFileProgress).on("filecomplete.upload",n.onComplete).on("fileerror.upload",n.onFileError).on("queued.upload",n.onQueued),o.find(".filelist.complete li").length==o.attr("media_max")&&o.find(".fs-upload-target").hide(),1==n.delete&&o.find(".filelist.complete li.data").find(".delete").on("click",(function(e){var t=a(this),i=n.removeUrl,o=t.attr("media_id"),r=t.attr("data_id");suda.disable(e),e.stopPropagation(),a.ajax({type:"POST",url:i,data:{UploadID:r,MediaID:o},dataType:"json",error:function(e){suda.modal(e)},success:function(e){null==e&&(e={});suda.modal(e);suda.enable(t),t.parent("li").fadeOut(500)}})}))},a.fn.zpuploadInit=function(e){var i={label:"上传图片",leave:"有图片正在上传，确定退出么?",maxQueue:1,delete:!1,postKey:"img",onComplete:t.zupload_complete},n=a.extend({},i,e),o=e.action,r=e.removeUrl,d={_token:suda.data("csrfToken")},l=a(this).attr("media_type");""!=l&&null!=l&&(d.media_type=l,o+="/"+l),n.action=o,n.removeUrl=r,n.postData=d,a(this).zpupload(n)};var t={options:{},zupload_complete:function(e,t,i){var n=a(this).attr("media_max")||1;if((i=a.parseJSON(i)).error)suda.modal(i.error);else{var o=a(this).find(".filelist.queue").find("li[data-index="+t.index+"]");$image_html=i.image,$image_html+="<input type='hidden' name='images["+i.media_id+"]' value='"+i.media_id+"'>",o.find(".file").html($image_html),o.find(".progress").remove(),o.find(".cancel").remove(),o.appendTo(a(this).find(".filelist.complete"));n=a(this).attr("media_max")||1;var r=a(this).find(".filelist.complete").find("li").length;r==n||r>n?a(this).find(".fs-upload-target").hide():a(this).find(".fs-upload-target").show()}},onCancel:function(e){var t=a(this).parents("li").data("index");a(this).find(".upload").upload("abort",parseInt(t,10))},onBeforeSend:function(e,a){return e.append("media_file","media_value"),e},onQueued:function(e,t){for(var i="",n=0;n<t.length;n++)i+='<li data-index="'+t[n].index+'"><div class="file">'+t[n].name+'</div><span class="progress">Queued</span><span class="cancel">cancel</span></li>';a(this).find(".filelist.queue").append(i)},onStart:function(e,t){a(this).find(".filelist.queue").find("li").find(".progress").text("Waiting")},onFileStart:function(e,t){a(this).find(".filelist.queue").find("li[data-index="+t.index+"]").find(".progress").text("0%")},onFileProgress:function(e,t,i){a(this).find(".filelist.queue").find("li[data-index="+t.index+"]").find(".progress").text(i+"%")},onFileComplete:function(e,t,i){if((i=a.parseJSON(i)).error)a(this).find(".filelist.queue").find("li[data-index="+t.index+"]").addClass("error").find(".progress").text(i.error);else{var n=a(this).find(".filelist.queue").find("li[data-index="+t.index+"]");n.find(".file").html(i.image),n.find(".progress").remove(),n.find(".cancel").remove(),n.appendTo(a(this).find(".filelist.complete"))}},onFileError:function(e,t,i){a(this).find(".filelist.queue").find("li[data-index="+t.index+"]").addClass("error").find(".progress").text("Error: "+i)}}}))})();